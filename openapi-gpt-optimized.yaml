openapi: 3.1.0
info:
  title: Workout Tracker GPT API
  version: 14.0.0
  description: |
    Comprehensive workout tracking API optimized for ChatGPT integration.

    Features:
    - Create and manage workout templates with flexible day-based structure
    - Log workout sessions with detailed set-by-set tracking
    - Track progress over time for exercises and workouts
    - Automatic history calculations and aggregations
    - Support for progressive overload and superset tracking

    This API uses Supabase PostgREST with specialized RPC functions for complex workflows.
    Authentication: JWT tokens via Authorization header (handled by Supabase).

servers:
  - url: https://xcydnrhqidokisawwhzc.supabase.co/rest/v1
    description: Production Supabase instance

security:
  - apiKeyAuth: []

paths:
  # Workout Management
  /rpc/create_workout:
    post:
      operationId: createWorkout
      summary: Create a new workout plan
      description: Creates a new workout plan with validation. Optionally set as active workout.
      tags:
        - Workouts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workout_name
                - workout_days
              properties:
                workout_name:
                  type: string
                  description: Name of the workout plan
                  example: "Push Day A"
                workout_description:
                  type: string
                  description: Optional description of the workout
                  example: "Chest, shoulders, and triceps focused workout"
                workout_days:
                  $ref: '#/components/schemas/WorkoutDays'
                make_active:
                  type: boolean
                  description: Set this workout as the active workout (optional, defaults to false)
                  default: false
      responses:
        '200':
          description: Workout created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  workout_id:
                    type: string
                    format: uuid
                  message:
                    type: string

  /rpc/get_active_workout:
    post:
      operationId: getActiveWorkout
      summary: Get the currently active workout
      description: Returns the currently active workout with all details including exercises for each day.
      tags:
        - Workouts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Active workout details
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  description:
                    type: string
                  days:
                    $ref: '#/components/schemas/WorkoutDay'
                  is_active:
                    type: boolean
      
  /rpc/set_active_workout:
    post:
      operationId: setActiveWorkout
      summary: Set a workout as active
      description: Activates a workout plan and deactivates all others. Only one workout can be active at a time.
      tags:
        - Workouts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workout_uuid
              properties:
                workout_uuid:
                  type: string
                  format: uuid
                  description: UUID of the workout to activate
      responses:
        '200':
          description: Workout activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
      
  /rpc/get_workout_for_day:
    post:
      operationId: getWorkoutForDay
      summary: Get workout plan for a specific day
      description: Returns the workout plan for a specific day from the active workout (or specified workout).
      tags:
        - Workouts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - day_name
              properties:
                day_name:
                  type: string
                  description: Name of the day (e.g., "monday", "tuesday")
                  example: "monday"
                workout_uuid:
                  type: string
                  format: uuid
                  description: Optional specific workout UUID. Uses active workout if not provided.
      responses:
        '200':
          description: Workout plan for the specified day
          content:
            application/json:
              schema:
                type: object
                properties:
                  day_name:
                    type: string
                  exercises:
                    type: array
                    items:
                      type: object
                      properties:
                        exercise:
                          type: string
                        sets:
                          type: integer
                        reps:
                          type: integer
                        weight:
                          type: integer
                        superset_group:
                          type: string
                        notes:
                          type: string
      
  # Exercise Management
  /rpc/add_exercise_to_day:
    post:
      operationId: addExerciseToDay
      summary: Add exercise to a workout day
      description: Adds a new exercise to a workout day. Creates the day if it does not exist.
      tags:
        - Exercises
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workout_uuid
                - day_name
                - exercise_name
                - sets
                - reps
                - weight
              properties:
                workout_uuid:
                  type: string
                  format: uuid
                day_name:
                  type: string
                  example: "monday"
                exercise_name:
                  type: string
                  example: "Bench Press"
                sets:
                  type: integer
                  minimum: 1
                  example: 3
                reps:
                  type: integer
                  minimum: 1
                  example: 10
                weight:
                  type: integer
                  minimum: 0
                  example: 135
                superset_group:
                  type: string
                  description: Optional superset grouping (e.g., "A", "B")
                  example: "A"
                notes:
                  type: string
                  description: Optional exercise notes
      responses:
        '200':
          description: Exercise added successfully
      
  /rpc/remove_exercise_from_day:
    post:
      operationId: removeExerciseFromDay
      summary: Remove exercise from a workout day
      description: Removes a specific exercise from a workout day.
      tags:
        - Exercises
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workout_uuid
                - day_name
                - exercise_name
              properties:
                workout_uuid:
                  type: string
                  format: uuid
                day_name:
                  type: string
                exercise_name:
                  type: string
      responses:
        '200':
          description: Exercise removed successfully
      
  /rpc/update_workout_day_weight:
    post:
      operationId: updateWorkoutDayWeight
      summary: Update exercise weight in workout template
      description: Updates a specific exercise weight in a workout day template. Returns old and new values.
      tags:
        - Exercises
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workout_uuid
                - day_name
                - exercise_name
                - new_weight
              properties:
                workout_uuid:
                  type: string
                  format: uuid
                day_name:
                  type: string
                exercise_name:
                  type: string
                new_weight:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Weight updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  old_weight:
                    type: integer
                  new_weight:
                    type: integer
      
  # Session Management
  /rpc/create_session:
    post:
      operationId: createSession
      summary: Create a new workout session
      description: Creates a new workout session with set-by-set entries.
      tags:
        - Sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - entries
              properties:
                workout_id:
                  type: string
                  format: uuid
                  description: Optional workout reference
                date:
                  type: string
                  format: date
                  description: Session date (defaults to today)
                entries:
                  type: array
                  description: Array of performed sets
                  items:
                    type: object
                    required:
                      - exercise
                      - set
                      - reps
                      - weight
                    properties:
                      exercise:
                        type: string
                        example: "Bench Press"
                      set:
                        type: integer
                        example: 1
                      reps:
                        type: integer
                        example: 10
                      weight:
                        type: integer
                        example: 135
                notes:
                  type: string
                  description: Optional session notes
      responses:
        '200':
          description: Session created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  session_id:
                    type: string
                    format: uuid
      
  /rpc/update_entry_weight:
    post:
      operationId: updateEntryWeight
      summary: Update set weight in a session
      description: Updates a specific set weight in a session entry. Returns old and new values.
      tags:
        - Sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - session_uuid
                - exercise_name
                - set_number
                - new_weight
              properties:
                session_uuid:
                  type: string
                  format: uuid
                exercise_name:
                  type: string
                set_number:
                  type: integer
                  minimum: 1
                new_weight:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Weight updated successfully
      
  /rpc/update_entry_reps:
    post:
      operationId: updateEntryReps
      summary: Update set reps in a session
      description: Updates a specific set reps in a session entry. Returns old and new values.
      tags:
        - Sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - session_uuid
                - exercise_name
                - set_number
                - new_reps
              properties:
                session_uuid:
                  type: string
                  format: uuid
                exercise_name:
                  type: string
                set_number:
                  type: integer
                  minimum: 1
                new_reps:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: Reps updated successfully
      
  # Progress Tracking
  /rpc/get_exercise_progress:
    post:
      operationId: getExerciseProgress
      summary: Get exercise progress history
      description: Returns history for a specific exercise over time with volume, weight, and rep trends.
      tags:
        - Progress
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - exercise_name_param
              properties:
                exercise_name_param:
                  type: string
                  description: Name of the exercise to track
                  example: "Bench Press"
                workout_uuid:
                  type: string
                  format: uuid
                  description: Optional filter by specific workout
                days_back:
                  type: integer
                  description: Number of days to look back
                  default: 30
                  example: 30
      responses:
        '200':
          description: Exercise progress data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProgressData'
      
  /rpc/get_recent_progress:
    post:
      operationId: getRecentProgress
      summary: Get recent workout history
      description: Returns workout history for the last N days, optionally filtered by workout.
      tags:
        - Progress
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workout_uuid:
                  type: string
                  format: uuid
                  description: Optional filter by specific workout
                days_back:
                  type: integer
                  description: Number of days to look back
                  default: 7
                  example: 7
      responses:
        '200':
          description: Recent workout history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProgressData'
      
  # History Calculations
  /rpc/calc_exercise_history:
    post:
      operationId: calcExerciseHistory
      summary: Calculate exercise history aggregates
      description: Aggregates session data into exercise_history for a specific date. Idempotent - can be run multiple times safely.
      tags:
        - History
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                date_override:
                  type: string
                  format: date
                  description: Specific date to calculate (defaults to today)
      responses:
        '200':
          description: Exercise history calculated successfully
      
  /rpc/calc_all_history:
    post:
      operationId: calcAllHistory
      summary: Calculate all history aggregates
      description: Runs both calc_exercise_history and calc_workout_history in a single transaction for a specific date.
      tags:
        - History
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                date_override:
                  type: string
                  format: date
                  description: Specific date to calculate (defaults to today)
      responses:
        '200':
          description: All history calculated successfully
      
components:
  securitySchemes:
    apiKeyAuth:
      type: apiKey
      in: header
      name: apikey
  schemas:
    Exercise:
      type: object
      description: A single exercise entry in a workout day
      required:
        - exercise
        - sets
        - reps
        - weight
      properties:
        exercise:
          type: string
          description: Name of the exercise (e.g., "Bench Press", "Squats")
          example: "Bench Press"
        sets:
          type: integer
          description: Number of sets to perform
          example: 3
        reps:
          type: integer
          description: Number of repetitions per set
          example: 10
        weight:
          type: integer
          description: Weight in pounds or kg
          example: 135
        superset_group:
          type: string
          description: Optional superset grouping identifier (e.g., "A", "B")
          example: "A"
        notes:
          type: string
          description: Optional notes or modifications for this exercise
          example: "Pause for 2 seconds at bottom"

    WorkoutDays:
      type: object
      description: |
        REQUIRED parameter for create_workout.
        A mapping of day names to exercise arrays.
        Each key is a day name: "monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"
        Each value is an array of Exercise objects (each must have exercise, sets, reps, weight).
        Example: {"monday": [{exercise: "Bench Press", sets: 3, reps: 10, weight: 135}], "wednesday": [{...}]}
        Cannot be null, empty, or omitted.
      properties: {}
      additionalProperties:
        type: array
        description: Array of exercises for this day
        minItems: 1
        items:
          $ref: '#/components/schemas/Exercise'
      minProperties: 1
      example:
        monday:
          - exercise: "Bench Press"
            sets: 3
            reps: 10
            weight: 135
            superset_group: "A"
          - exercise: "Incline Dumbbell Press"
            sets: 3
            reps: 12
            weight: 60
            superset_group: "A"
        wednesday:
          - exercise: "Squats"
            sets: 4
            reps: 8
            weight: 225
        friday:
          - exercise: "Deadlifts"
            sets: 3
            reps: 5
            weight: 315

    WorkoutDay:
      type: object
      description: |
        A day's workout schedule mapped by day name to exercise arrays.
        Keys should be day names (e.g., "monday", "tuesday", "wednesday").
        Values are arrays of exercises to perform that day.
      properties: {}
      additionalProperties:
        type: array
        description: Array of exercises for this day
        items:
          $ref: '#/components/schemas/Exercise'

    SessionEntry:
      type: object
      required:
        - exercise
        - set
        - reps
        - weight
      properties:
        exercise:
          type: string
          example: "Bench Press"
        set:
          type: integer
          example: 1
        reps:
          type: integer
          example: 10
        weight:
          type: integer
          example: 135

    ProgressData:
      type: object
      properties:
        date:
          type: string
          format: date
        total_volume:
          type: integer
        max_weight:
          type: integer
        avg_weight:
          type: number
        total_sets:
          type: integer
        total_reps:
          type: integer

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true

tags:
  - name: Workouts
    description: Workout template management
  - name: Exercises
    description: Exercise management within workouts
  - name: Sessions
    description: Workout session logging
  - name: Progress
    description: Progress tracking and analytics
  - name: History
    description: Historical data aggregation
